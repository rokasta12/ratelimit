---
title: "@jf/ratelimit-h3"
description: "Rate limiting middleware for H3 and Nitro. Protect your Nitro servers and H3 APIs with sliding window rate limiting."
---

Rate limiting middleware for [H3](https://h3.unjs.io/) and [Nitro](https://nitro.unjs.io/) - the universal JavaScript server framework.

## Installation

```bash
npm install @jf/ratelimit-h3
```

## Basic Usage

```ts
import { createApp, eventHandler } from "h3";
import { rateLimiter } from "@jf/ratelimit-h3";

const app = createApp();

app.use(
  rateLimiter({
    limit: 100,
    windowMs: 60_000,
  }),
);

app.use(eventHandler(() => "Hello!"));

export default app;
```

## Nitro Server Middleware

```ts
// server/middleware/ratelimit.ts
import { rateLimiter } from "@jf/ratelimit-h3";

export default rateLimiter({
  limit: 100,
  windowMs: 60_000,
});
```

## Options

| Option         | Type                                 | Default            | Description             |
| -------------- | ------------------------------------ | ------------------ | ----------------------- |
| `limit`        | `number \| (event) => number`        | `60`               | Max requests per window |
| `windowMs`     | `number`                             | `60000`            | Window duration in ms   |
| `algorithm`    | `'fixed-window' \| 'sliding-window'` | `'sliding-window'` | Algorithm               |
| `store`        | `RateLimitStore`                     | `MemoryStore`      | Storage backend         |
| `keyGenerator` | `(event) => string`                  | IP-based           | Client identifier       |
| `skip`         | `(event) => boolean`                 | -                  | Skip rate limiting      |
| `handler`      | `(event, info) => void`              | 429 response       | Custom handler          |

## Access Rate Limit Info

```ts
// server/api/data.ts
export default eventHandler((event) => {
  const info = event.context.rateLimit;
  // { limit: 100, remaining: 99, reset: 1234567890 }

  return { data: "hello" };
});
```

## Custom Key Generator

```ts
import { getHeader, getRequestIP } from "h3";

app.use(
  rateLimiter({
    limit: 100,
    windowMs: 60_000,
    keyGenerator: (event) => {
      return getHeader(event, "x-user-id") ?? getRequestIP(event) ?? "unknown";
    },
  }),
);
```

## With Redis

```ts
// server/plugins/ratelimit.ts
import { createStorage } from "unstorage";
import redisDriver from "unstorage/drivers/redis";
import { createUnstorageStore } from "@jf/ratelimit-unstorage";

export const rateLimitStore = createUnstorageStore({
  storage: createStorage({
    driver: redisDriver({ url: process.env.REDIS_URL }),
  }),
});

// server/middleware/ratelimit.ts
import { rateLimiter } from "@jf/ratelimit-h3";
import { rateLimitStore } from "../plugins/ratelimit";

export default rateLimiter({
  limit: 100,
  windowMs: 60_000,
  store: rateLimitStore,
});
```

## Related

- [H3 Documentation](https://h3.unjs.io/)
- [Nitro Documentation](https://nitro.unjs.io/)
- [@jf/ratelimit-nuxt](/ratelimit/packages/nuxt/) - For Nuxt applications
- [@jf/ratelimit-unstorage](/ratelimit/packages/unstorage/) - Storage adapter
